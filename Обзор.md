Новый детективный вариант в Фрайбурге(XIX–XX вв.): план адаптации проекта
Повторно используемые системы проекта

Ваш текущий проект «Эхо Фрайбурга» уже обладает всеми необходимыми механиками, которые можно переиспользовать в новом детективном сценарии:

Визуальные новеллы (VN-сцены) – Диалоговые сцены с нелинейностью, проверками навыков, флагами и эффектами. Эти сцены уже реализованы на движке (см. VisualNovelPage и сценарии в src/entities/visual-novel/scenarios/) и интегрированы с бэкендом. В новом сценарии Фрайбург вы можете так же создавать VN-сцены для допросов, осмотров мест преступлений и т.д., используя существующую систему проверок навыков/«голосов» и выставления флагов для отслеживания улик и решений.

Система квестов – Имеется полноценная квестовая подсистема (src/entities/quest/ и API /quests). В детективном сеттинге каждое дело можно оформить как квест или цепочку квестов. Квесты будут представлять расследования отдельных преступлений: последовательность задач по сбору улик, разговору с персонажами, анализу доказательств. Квестовая логика (этапы, цели, условия завершения) уже готова – требуется лишь наполнить её новым контентом (наборы задач, условия на флаги «улика найдена», «подозреваемый опрошен» и т.п.).

Карта с геоточками и привязкой сцен – Текущая карта на движке (Mapbox) поддерживает точки интереса, зоны, «туман войны» и привязку событий к конкретным координатам. Это идеально подходит для отображения реальных мест Фрайбург, связанных с делами. Уже реализован механизм sceneBindings – привязки VN-сцен к точкам на карте с разными типами триггеров (по клику, при сканировании QR и т.д.). Например, в текущем проекте некоторые сцены привязаны к точкам и срабатывают только после сканирования QR-кода на месте. Мы можем использовать тот же принцип: каждая локация преступления в Фрайбург будет представлена точкой на карте, при взаимодействии с которой (или сканировании соответствующей улики) запускается сцена расследования.

Геолокационные триггеры через QR-коды – В проекте реализован цикл взаимодействия с реальным миром: сканирование QR-кода дает определенные действия (actions) от сервера. Сейчас это используется для геймификации геолокации (например, открыть точку, выдать лут или запустить сцену). В детективном варианте это отлично ложится на сбор улик и документов. Например, QR-код, размещенный на реальном объекте (или представленный как «найденный документ» в игре), может разблокировать новую точку на карте или сразу запустить диалоговую сцену с уликой. Система поддерживает разные действия: пометка точки как обнаруженной (unlock_point), добавление флага прогресса (add_flags), запуск VN-сцены (start_vn), изменение репутации фракций (grant_reputation) и пр.. Это позволяет при нахождении улики автоматически обновлять игру: открыть новую локацию, дать игроку предмет-доказательство или включить реплику персонажа.

Регион Фрайбург на карте – В кодовой базе уже заложена возможность переключаться на регион Фрайбург. В regions.ts присутствует пресет для Фрайбург (с уникальными параметрами биомов и ресурсов). То есть карта города, координаты центра и изображение региона Фрайбург уже определены. Это означает, что технически можно использовать существующую функциональность карты, просто указав регион id: 'frayburg' – игрок будет перемещаться по карте Фрайбург. В текущей реализации регион Фрайбург задуман как «университетский техно-хаб» (с повышенным весом техно-биома и административных областей), что как раз совпадает с образом города в конце XIX века – центр науки (Политехникум) и управления (резиденция правительства). Таким образом, география Фрайбург уже интегрируема в игру, останется лишь добавить конкретные точки-локации в сиды базы данных (например, Дворец, Политехнический институт, газету, промышленный район и пр.) и привязать к ним сцены.

Система “Внутренний парламент” (18 голосов) – Оригинальная игра отказалась от классических атрибутов (сила, ловкость и пр.) в пользу 18 внутренних «голосов» героя, разбитых на 6 групп, которые влияют на диалоги и восприятие. Эти «голоса» – уникальная механика, напоминающая навыки/аспекты личности (аналогично Disco Elysium). В детективной истории эту систему можно переосмыслить как различные методы расследования, спорящие в голове сыщика. Например, вместо абстрактных «Психея», «Сознание», «Социальность» можно ввести конкретные роли: Логика (аналитическое мышление), Наблюдательность, Интуиция, Психология (эмпатия к людям), Авторитет (волевой нажим), Авантюризм (рисковый подход) и т.д. Эти внутренние голоса-методы будут предлагать свои пути решения загадок, иногда конфликтовать – тем самым сохранив полифонию оригинала, но в тематике викторианского расследования. Технически система уже есть – голоса вмешиваются в VN-диалоги, дают дополнительные опции или комментарии. Нужно будет лишь перенастроить/переименовать их под детективную стилистику (в коде – обновить определения голосов в parliament.ts/voiceDefinitions.ts, чтобы отразить новые архетипы методов расследования).

Боевая система (карточный баттлер) – В проекте реализован пошаговый бой на картах, хотя он сейчас отключен (страница BattlePage заглушена). Если есть желание сохранить экшн-элемент в детективной игре, его можно творчески адаптировать под «схватки» в духе жанра. Например, карточный бой переосмыслить как драматичные конфликты: дуэль мнений, допрос, погоня или драка в переулке. Карты при этом выступают приемами сыщика:

«Наблюдение» – позволяет заметить важную деталь или слабое место противника (снижает «защиту» оппонента, повышает шанс успеха следующего хода).

«Блеф» – дезориентирует противника ложной информацией.

«Упреждение» – быстрый выпад (физический или словесный), чтобы сбить с толку (аналог ускоренной атаки).

«Давление авторитетом» – надавить статусом или интонацией (может оглушить противника – пропуск хода).

«Подкуп свидетеля» – расходует ресурс (деньги) взамен на информацию (в бою могло бы instantly “победить” цель или нейтрализовать конфликт без драки).

Подобные приёмы можно отразить картами. Ресурсы (энергия, «мана») переинтерпретировать как выносливость героя или психологическое давление. Очки здоровья могут означать шкалу убеждённости или выдержки в конфликте. Таким образом, существующий карточный движок не пропадет: он будет фоном для ключевых сцен – например, финального противостояния с антагонистом, напряжённого допроса главного подозреваемого, перестрелки с бандитами. При этом в коде вместо боевых анимаций можно минимально поменять UI и тексты (например, переименовать “Бой” в “Схватка”, типы урона – на типы воздействия, иконки оружия заменить на иконки улик/документовых доказательств, если это делается на уровне ассетов).

Инвентарь и предметы – В оригинале есть продвинутая система инвентаря с экипировкой, лутом, торговлей и крафтом. В детективной истории необходимость в сложном крафте отпадает, но инвентарь можно использовать для улик и инструментов. Например, каждая найденная улика (письмо, фотография, орудие убийства) может существовать как предмет в инвентаре. С помощью QR-бонусов можно выдавать такие предметы игроку (grant_items при сканировании улики). Эти предметы могут иметь описания, которые игрок просматривает для анализа (как бы разглядывает улику ближе). Также можно ввести инструменты сыщика – скажем, лупа, набор отмычек, револьвер – и хранить/улучшать их через существующую систему. Если торговля не актуальна, её можно отключить, но инвентарь по крайней мере послужит книгой улик.

Сюжетный сеттинг: Фрайбург, конец XIX – начало XX века

Концепция: Игрок выступает в роли частного сыщика (или приглашённого расследователя) в городе Фрайбург эпохи конца 19-го – начала 20-го века. Это время развитого промышленного капитализма, расцвета науки и техники, а также социальных потрясений. Город Фрайбург выбран не случайно: он исторически был столицей Великого герцогства Баден, центром администрации и образования (знаменитый Политехникум). Главное архитектурное своеобразие – радиально-кольцевая планировка (“Fächerstadt”, фан-город) с дворцом в центре и улицами-лучами. Мы используем это как часть загадки: серия преступлений происходит на улицах-лучах, исходящих из центра, и образует таинственный узор на карте. Игрок должен разгадать закономерность – например, обнаружить, что места преступлений идут по часовой стрелке от дворца или расположены на определённом кольце. Карта сама по себе станет шифром: каждая следующая подсказка указывает на новую локацию на следующем «луче» или следующем кольцевом авеню.

Атмосфера: детективный нуар с элементами викторианского стиля. Представьте расследование в духе Шерлока Холмса: газовые фонари, кареты, первые автомобили, смесь старых традиций и новых технологий (телеграф, фотокамеры, зарождающаяся криминалистика). Можно слегка привнести стимапанк-антураж (например, ранние научные устройства для анализа улик) или же держаться реализма. Внутренний парламент героя (его голоса-методы) обеспечивает нуарное звучание: они комментируют сцены, спорят о морали, о природе преступления, о том, какой подход лучше – логика или интуиция, и т.п.

Роли игрока: По сюжету игрок-сыщик может быть свободным детективом, приехавшим из другого города расследовать череду необычных преступлений, или человеком, нанятым местной полицией. Это дает повод знакомиться с разными слоями общества Фрайбург. В механике это отразится через фракции влияния (см. ниже) – кому вы служите и чьи интересы учитываете.

Новые фракции и их влияние

В оригинальной игре постапокалиптического Фрайбурга были фракции-кланы, привязанные к зонам (Анархисты, Артисанты, Синтез, Ордунунг и т.д.). Для исторического Фрайбурга логично ввести шесть новых фракций, соответствующих силам того времени:

Полиция и Бюрократия – официальные власти. Олицетворяют порядок и давление. В игре это аналог фракции Ordnung (порядок) из оригинала, но в историческом контексте: полиция, суд, городская администрация. Их база – возможно, старое здание префектуры или полицейский участок. Сыщик, сотрудничая с ними, получает доступ к архивам, ордерам, охране, но может столкнуться с их косностью и политическим давлением. Репутация с этой фракцией может давать бонусы (например, быстрее получать информацию из официальных каналов).

Политехникум / Университет – академическое сообщество Фрайбурга (напомним, Фрайбург имел знаменитый Политехнический институт, позднее Технологический институт – один из старейших в Германии). Эта фракция представляет рациональность и раннюю криминалистику. Профессора, студенты, учёные могут помогать анализировать улики: химическое исследование яда, баллистика, зарождающаяся дактилоскопия (отпечатки пальцев тогда только входили в обиход). Их «влияние» – доступ к лаборатории, экспертные знания. Но у них свои интересы (например, стремление к славе открытия, конкуренция с чиновниками).

Промышленники и Цехи – богатые заводчики, владельцы фабрик, торговцы, гильдии ремесленников. Это сила денег, капитал и влияние, а также рабочие движения (забастовки, профсоюзы). В Фрайбурге конца XIX в. были промышленные предприятия, железная дорога, порт на Рейне. Фракция может контролировать заводской район, иметь частную охрану. Для сыщика они и источник информации (через рабочих, слухи на заводах), и потенциальные подозреваемые (финансовые махинации, устранение конкурентов). Их методы – подкуп, давление через богатство. Конфликт между промышленниками и рабочими может выступать фоном для дела (например, инсценировка преступления для дискредитации профсоюза).

Пресса – городские газеты, репортёры и издатели. В эпоху без телевидения газета – главный источник новостей, а журналисты – своеобразные детективы тоже. Фракция Прессы символизирует информацию и шантаж. Союз с журналистом может помочь герою вынести факты на публику или найти скрытые сведения через сеть осведомителей. Но если отношения плохие, пресса может очернить репутацию героя (в механике это можно отразить особым флагом или понижением репутации, влияющим на поведение NPC). Возможно введение механики времени: если газета раньше времени опубликует материал, преступник сменит план. Это добавит напряжения. В любом случае, газетная вырезка или анонс может быть подан даже как игровой объект (улика) или как экранная вставка.

Подполье (криминальный мир) – в каждом городе есть теневая сторона. Контрабандисты, владельцы кабаре, бандиты, воры – они объединены здесь в фракцию «Ночное подполье», предоставляющее «услуги ночного Фрайбурга». Это аналог контрабандистов/торговцев из оригинала, но без постапокалиптики: казино, притоны, тайные клубы. От них герой может получить нелегальную помощь (например, достать ключ или информацию через шантаж), но и дела часто упираются в их разборки. Репутация с этой фракцией означает доверие криминальной среды. Игрок может решать – действовать по закону (через полицию) или по понятиям (через преступников), и игра будет реагировать на это (вплоть до разных финалов дела).

«Кружок» / Тайное общество – скрытая сила, вероятно антагонистическая. Здесь можно дать волю фантазии: либо реалистичный тайный орден (например, масоны, оккультный кружок, политический заговор), либо привнести легкую мистику (общество спиритистов, которому как будто помогает нечто потустороннее). Кружок действует в тени, возможно, и есть истинный виновник серии преступлений. Для героя столкновение с ними – финальный вызов. В механике это может выражаться через отдельную скрытую ветку квестов (игрок не сразу узнает о существовании этой группы, надо собрать много улик). Фракция «Кружок» не будет явной в интерфейсе сначала (репутацию с ними не прокачать обычным путем), но отдельные NPC могут оказаться членами этого общества. Когда герой раскроет их, можно открыть и саму фракцию в интерфейсе, как врага.

Эти фракции заменят постапокалиптические кланы, но по структуре сходны: каждая привязана к определённым районам на карте Фрайбурга и ключевым NPC. Например, Полиция контролирует центр (ратуша, участок), Университет – квартал вокруг Политехникума, Промышленники – заводская окраина к западу/югу, Пресса – редакция возле центра, Подполье – порт и ночные заведения, Кружок – возможно, сеть тайных локальных точек (старая библиотека, заброшенная масонская ложа и т.п.). На уровне данных каждая точка на карте имеет поле faction (в оригинале есть привязка faction в metadata точки). Нужно будет определить новые идентификаторы фракций (например, police, university, industrialists, press, underworld, society) и назначить их соответствующим точкам/локациям. Система репутации с фракциями уже существует – grant_reputation можно вызывать при выполнении квестов или сканировании улик. Это позволит отслеживать отношения игрока с каждой группировкой в детективном сценарии (например, помогли ли вы полиции или действовали вне закона).

Механика «Внутренний парламент» как методы расследования

Особое внимание – адаптации 18 внутренних голосов героя под детектива. Как уже отмечалось, вместо боевых и выживательных качеств, эти голоса станут разными гранями ума сыщика. Можно разбить их тоже на 6 групп по 3, сохранив структуру, но переименовав в соответствии с ролями. Пример новой группировки:

Мозг (Аналитика):

Логика – способность выстраивать цепочки выводов, анализ улик (бывший “Разум” в оригинале). Голос логики даёт подсказки, строит теории.

Внимательность – олицетворяет остроту зрения и чувств. Помогает заметить детали на месте преступления (например, дополнительный интерактив в сцене, если голос срабатывает).

Образованность – знание фактов, эрудиция. Аналог энциклопедии (как навык Encyclopedia в Disco Elysium). Этот голос может выдавать справки об объектах (город, люди, наука).

Душа (Интуиция и психология):

Интуиция – шестое чувство, догадки без явных оснований. Иногда предупреждает об опасности или подсказывает нестандартное решение.

Эмпатия – умение понимать эмоции и мотивы людей. Полезно при допросах: подсказывает, когда подозреваемый лжет или что его тревожит.

Воображение (или Внутренний романтик) – склонность к теоретизированию, «склеиванию» разрозненных фактов в общую картину, даже фантастическую. Может как помочь увидеть целое раньше времени, так и увести в сторону (генерируя ложные версии).

Характер (Социальные и волевые качества):

Авторитет – голос, стремящийся доминировать. Помогает придавить подозреваемого, внушить страх или добиться подчинения. Но может мешать, провоцируя излишнюю грубость.

Обаяние – шарм, умение найти подход. Подсказывает дипломатичные варианты, располагает NPC.

Хладнокровие – внутренняя выдержка, способность сохранять спокойствие. Полезно чтобы не поддаться панике, противостоит влиянию страха или смущения.

Тело (физические аспекты):

Выносливость – физическая крепость, умение терпеть лишения. Пригодится, если расследование требует долгой погони, драки или просто бессонных ночей.

Ловкость – быстрота реакции, рук и ног. Поможет в погоне, в скрытом преследовании, в незаметном проникновении (если придётся лазать по окнам или прятаться).

Внимательность к уличным мелочам – (здесь можно другое назвать, например Форензика или Техник). Этот голос отвечает за применение инструментов, работу с физическими уликами: снять отпечатки, вскрыть замок, анализ крови. Он перекликается с внимательностью, но более практичен.

(Приведенная группировка – лишь пример; важно, что все 18 слотов будут заполнены тематическими качествами. В коде вы продолжите использовать существующую механику голосов: каждый такой “навык” имеет свой ID, уровень, и может быть проверен в VN-сцене, давая альтернативные пути диалога или автоматические реплики героя.)

Применение: В диалогах и описаниях сцены голоса будут проявляться, как и раньше. Например, при осмотре места убийства голос «Внимательность» может текстом указать на неприметную деталь (“Ты замечаешь странный запах горького миндаля – это мог быть цианид.”). Логика потом может сделать вывод (“Цианид часто используют в таких-то случаях…”). Если какой-то голос низок, герой может упустить эти выводы, и игроку будет сложнее – т.е. сохраняется RPG-элемент прокачки голосов, влияющий на успех расследования. При допросе, высокий Авторитет откроет опцию нажать на свидетеля, высокая Эмпатия – опцию успокоить и расположить к откровенности. Внутренние разногласия голосов добавят глубины: к примеру, Логика убеждает идти по фактам, Интуиция нашептывает поверить странной догадке, Авантюрист предлагает рискованную провокацию. Это обогатит повествование, сохранив уникальную черту вашего проекта.

Квесты-расследования и прогресс сюжета

Как упоминалось, каждое дело = квест или их набор. Структура общего нарратива может быть нелинейной: у игрока могут быть несколько открытых дел (побочных), помимо основной сюжетной линии. Но можно и последовательно – тут выбор за вами. Опишем возможный подход:

Основная сюжетная линия – цепочка из, скажем, 5–6 взаимосвязанных дел, раскрывающих грандиозный заговор «Тайного кружка». Первые дела выглядят отдельными (например: 1) Убийство на рынке, 2) Пропажа студента Политехникума, 3) Поджог в промышленном цеху, …), но постепенно герой находит связь. Каждое дело – отдельный квест со своими этапами:

Этапы дела обычно включают: осмотр места преступления (сбор улик, запуск сцен при клике на разные объекты внутри VN-сцены), опрос 2–3 ключевых NPC (в диалогах, возможно тех самых схватках/допросах), поиск информации (либо через документы – газеты, архивы, либо через слежку за подозреваемым). Все эти действия легко моделируются существующими механиками:

Осмотр места можно сделать VN-сценой с несколькими интерактивными выборочными пунктами (“Осмотреть тело”, “Изучить окружение”, “Искать следы возле двери” и т.д.), которые устанавливают определенные флаги при находке улики.

NPC на месте могут быть оформлены как отдельные точки на карте (например, свидетель отмечен как npc-точка рядом с локацией преступления) или как часть сцены. Их разговоры тоже VN-сцены, результаты которых (успешно ли получили информацию) фиксируются флагами.

Документы могут требовать сходить в архив (локация архивов полиции или библиотека). Там тоже либо мини-игра (найти нужную книгу – например, выбор в VN-сцене), либо просто факт посещения через QR.

Прогресс и условия: После сбора ключевых улик квест помечается выполненным, и игрок продвигается к следующему. Здесь пригодится использование флагов и проверок перед выдачей следующего квеста. Например, чтобы начать дело №2, нужно, чтобы дело №1 завершилось (flag case1_solved = true). Можно настроить появление новой точки на карте или новой сцены через unlock_point в момент завершения (например, в финале дела №1 сыщик находит карту города с отметкой, и игра через actions[] открывает новую точку на карте – место для начала дела №2).

Побочные дела – опционально, могут существовать независимые расследования (например, по просьбе газеты раскрыть тайну пропажи кошек в парке, которая приведет к местному сумасшедшему ученому – маленькая история, позволяющая прокачать навыки и повысить репутацию с Прессой и Университетом). Такие квесты делаются аналогично, но не обязятельны для главного сюжета. Их можно привязать к разным районам, чтобы мотивировать игрока исследовать всю карту Фрайбурга.

Нелинейность и выборы: Благодаря VN-сценам с вариантами, дела могут иметь несколько путей решения. Например, можно обвинить одного подозреваемого (по косвенным уликам) или продолжить копать и найти истинного виновника. В зависимости от выбора, какие-то флаги выставятся, и это повлияет дальше: если посадили не того, настоящее преступление повторится – динамика для игрока. Механика флагов позволяет такие последствия отслеживать. Также это отразится на репутации с фракциями (скажем, посадили рабочего вместо фабриканта – рабочие/подполье будут в ярости, репутация с ними упадёт, зато промышленники довольны).

Локации на карте и привязка сцен

Город Фрайбург будет игровым полем. Нужно будет определить ключевые точки на карте – реальные места, важные для историй. Примеры точек для детективного Фрайбурга:

Дворец Фрайбурга (Schloss) – центральная локация, возможно, сцена вступления (например, герой прибыл на приём к начальству, либо финальная сцена противостояния в подземельях под дворцом, если связать с тайным обществом). Дворец и парк вокруг могут выступать декорацией нескольких дел.

Ратуша / Полицейский участок – место, где герой берёт поручения, сдаёт отчёты. Тут же архивы (по механике: точка с услугой archives). Можно совместить или сделать отдельно: Ратушная площадь – точка для бюрократов, здание полиции – отдельная точка.

Политехникум (KIT) – университетский кампус, где можно встретить профессора-соратника, отнести химические образцы, получить консультацию. Может быть задействован в деле, связанном с студентами или научными экспериментами.

Редакция газеты – точка “Пресса”. Здесь живёт свой NPC (главный редактор или журналист-информатор). Возможно, через эту точку запускаются сайд-квесты прессы.

Промышленная зона / завод – на карте Фрайбурга это может быть район Мюльбург или берег Рейна с портовыми складами. В одной из историй там происходит саботаж или тайная сходка. Точка фракции промышленников.

Гранд-отель или клуб – нейтральная территория, где пересекаются высшие чины. Может быть место сбора светского общества, маскирующее тайный кружок. Здесь можно устроить сцену слежки или скрытого проникновения.

Трущобы/Квартал красных фонарей – место подполья, контрабанды. Возможно, порт на Рейне играет эту роль: там кабаки для матросов, контрабандный рынок. Игровая точка с высокой опасностью, где можно “провести операцию под прикрытием” или завязать драку с бандитами.

Технически, для каждой такой точки создается запись в mapPoints (с уникальным id, названием, координатами и пр.). К точке привязываются:

sceneBindings – список сцен, которые могут в ней произойти. Например, точка "Редакция газеты" может иметь сцену встречи с редактором, которая запускается триггером click (когда игрок приезжает и нажимает "Войти"). А если, скажем, редакция сначала закрыта, то у точки стоит isActive: false или initiallyHidden: true и она разблокируется только при определенном флаге (например, вы получили приглашение от журналиста).

questBindings – если точка связана с квестом. Например, локация “Завод Герхарда” появляется (делается активной) только когда начинает соответствующий квест саботажа. Для этого у точки в metadata можно задать visibility.initiallyHidden: true и unlockRequirements.flags: ['quest_industrialSabotage_started']. После выполнения условия, точка становится видна на карте. Это уже используется в игре (в seed данных многие точки скрыты до определенных флагов) – можно следовать тому же шаблону.

qrRequired – для некоторых точек можно потребовать сканирования реального QR на месте, если цель – стимулировать игрока физически посетить локацию. Например, Дворцовая башня: чтобы получить оттуда обзорный план (улику), игрок должен быть реально там и сканировать QR-код (прикреплённый где-то). В коде это делается полем qrRequired: true и сохранением ожидаемого QR-пэйлода в map_points.qr_code. При сканировании сервер вернет action unlock_point и, возможно, start_vn для сцены находки. В текущем проекте есть пример: регистрация в ратуше открывается либо сканированием QR на месте, либо альтернативно нажатием. Аналогично, у вас “улика-документ” может быть реализована как QR-код: игрок наводит камеру (или просто нажимает кнопку сканирования в приложении на нужной геоточке), и получает контент (например, фотокарточку или записку – это можно выдать как notice с изображением и add_flags для прогресса).

Все эти механики уже заложены, вам нужно лишь сконфигурировать новые точки и сцены. Особое внимание – корректно проставить координаты (Фрайбург, в отличие от Карлсруэ, другой регион, но с вашим RegionConfig проблем быть не должно) и связать их флагами/квестами. Также стоит учесть туман войны: возможно, поначалу игрок видит лишь центральные районы, а дальние точки открываются по мере продвижения (это есть в оригинале для зон Фрайбурга).

QR-коды как улики и документы

Как отмечено, система QR-триггеров прекрасно подходит под механику нахождения улик. Поясним варианты применения:

Физические QR в городе: если вы планируете выездной геймплей (когда игрок реально ходит по Фрайбургу с приложением), можно разместить QR-стикеры в соответствующих локациях. Например, на воротах университета – QR, который в игре означает “документ с расписанием экспериментов”, или в парке у памятника – QR с тайником. Сканируя их, игрок продвигает сюжет. Технически скан возвращает actions – чаще всего unlock_point или start_vn. Можно комбинировать: сканирование улики сразу открывает VN-сцену, где герой «читает найденный документ» (текст сцены показывает содержимое письма, возможно, с изображением). После этого выставляется флаг “документ прочитан” и, например, открывается новая точка (адрес, упомянутый в письме).

QR как часть интерфейса расследования: даже если игрок не в Фрайбурге физически, можно заставить его «сканировать» улики внутри игры. Например, в интерфейсе при осмотре улиκи показывать псевдо-QR, который нужно нажать/сканировать. Это добавит интерактивности. Но это на ваше усмотрение; можно и без этого, ограничившись нажатием кнопки.

Bonus-QR для наград: Найденные тайники или бонусные сцены также можно оставить. Может быть, в городе спрятаны необязательные QR-коды (как пасхалки) – например, QR на старинной вывеске, который даёт историческую справку или маленькую сюжетную виньетку (через notice или даже мини-игру). В текущей реализации Bonus-QR легко добавить через таблицу QR_BONUSES. Такие бонусы могут давать опыт, предметы или просто лорный контент, не обязательно влияющий на основную историю.

Важно документировать все ожидания от QR: где какой код спрятан, что он даёт. В QR_SYSTEM.md уже описаны рекомендации (например, делать payload секретным, хранить факт сканирования через флаги) – следуйте им для надежности. Убедитесь, что для каждого ключевого QR есть альтернативный путь, чтобы не заблокировать игрока (как в примере с ратушей, где можно и нажатием продолжить). Например, если игрок не может физически сканировать, разрешить виртуальное взаимодействие по сюжету.

Схватки и погонι: адаптация боевой механики

Хотя основа игры – расследование, динамичные сцены придают разнообразие. У Шерлока Холмса, помимо дедукции, хватало погонь по крышам и стычек с преступниками. Ваш существующий боевой модуль можно использовать для таких моментов. Реализация может быть двухуровневая:

Событийная схватка в VN-сцене: Проще говоря, сделать выборы и проверки вместо полноценного боя. Например, герой догоняет злоумышленника – оформить как серию проверок ловкости/выносливости: если провал – подозреваемый уходит, квест развивается иначе. Это реализуется чисто сценарно (VN-ветвлениями) без запуска боевого экрана. Такой подход хорош для небольших столкновений.

Полноценный карточный бой как кульминация: Здесь включается ваш BattlePage. Его UI/UX нужно слегка перенастроить под детективный стиль (убрать упоминание “протоколы” и т.п., заменить названия карт). Карты-приемы уже описаны выше – их можно заложить как начальную колоду героя. Противники в таких боях – не фантастические монстры, а люди (бандит, телохранитель, главарь общества) или ситуации (например, “Преследование по крышам”: противник – таймер или цель, которая старается сбежать; вы “атакуете” его картами типа Прыжок, Рывок, а он отдаляется – можно творчески использовать механику). Поскольку система модульная, можно в данных врагов прописать новые атаки, соответствующие человеческим врагам (удар ножом, выстрел и пр., хотя без излишней жестокости – всё-таки акцент на умах).

Баланс: стоит упростить такие бои, сделать их скорее сюжетными – т.е. победа должна быть достижима, а поражение не приводит к “игре окончена”, а просто меняет ход истории (например, преступник скрылся, герой ранен – появится новый квест по восстановлению или поиск по горячим следам). Это легко контролировать через флаги: при запуске боя задать flags: chase_battle = true, а в сцене после боя проверить: если победил (флаг set через action после боя или через результат), то одна ветка, если нет – другая.

Интеграция и разработка нового контента

Чтобы реализовать всё вышеперечисленное, потребуется в основном контентная работа (нарративная и геймдизайн), а не кардинальная переделка движка. Итоговый план действий для внедрения детективного Фрайбурга:

Подготовка базы данных и конфигов:

Добавить новые фракции – либо в виде констант (если есть перечень в коде), либо соглашением об именах. Убедиться, что они учитываются в системе репутаций (возможно, прописать в factions.ts или аналогичном). Можно переиспользовать существующие слоты фракций, просто переименовав их для нового режима (например, ordnung -> police, anarchists -> использовать для подполья и т.д., если не хотите расширять список).

Настроить RegionConfig Freiburg при старте сюжета. Он уже есть, нужно только проверить, чтобы игра стартовала в этом регионе (вероятно, параметр в profile игрока или начальном сценарии). Также можно обновить weights под исторический контекст: ресурсы TECH/SCRAP в 1900 году неактуальны, но это не критично, если survival-механика не используется.

Задать ключевые точки на карте Фрайбурга: сформировать список SeedMapPoints (аналогично server/src/seeds/mapPoints.ts). Вписать координаты (их можно взять, например, из Google Maps для реальных мест). Разбить их по типам: poi (точки интереса), location, возможно npc для передвижных или временных NPC. В metadata проставить faction, atmosphere, initiallyHidden и т.п. Поле sceneBindings сразу указать с вашими будущими sceneId (даже если сцены еще пишутся). Если какая-то точка должна открываться через QR, поставить qrRequired: true и записать уникальный payload в qrCode.

QR-коды: Сгенерировать физически или концептуально QR для улик. Прописать их payload либо прямо в map_points.qr_code (для point-QR) либо добавить в QR_BONUSES для бонусов. Например, QR_BONUSES может получить запись { id: 'clue_letter_1', oneTime: true, actions: [ {type: 'start_vn', sceneId: 'clue_letter_1_scene'}, {type: 'add_flags', flags: ['clue_letter_1_read']} ] }. Тогда QR с payload gw3:bonus:clue_letter_1 запустит сцену чтения письма и пометит улику прочитанной.

Написание сценариев (VN):

Разработать сюжетные диалоги и описания для всех ключевых сцен: вступление, каждая улика, разговор с каждым подозреваемым, финальные раскрытия. Следует насыщать сцены проверками голосов, чтобы действительно использовать «внутренний парламент». Например, в JSON-сценарии прописать ветки, доступные при наличии определенного голоса > определенного значения, либо случайные реплики-мысли от голоса (в оригинале такие есть). Сами тексты лучше стилизовать под эпоху (лексика, вежливые формы обращения Herr, Frau и т.д. если на немецкой земле).

В сценах закладывать выставление флагов прогресса по итогам: add_flags: например, found_poison, suspect_confessed и т.п. Эти флаги потом используются для: разблокировки следующих сцен/точек, достижения концовок дела. Также предусмотреть add_flags для всяких мелочей: заметил ли игрок второстепенную улику – это может не влиять на сюжет, но повлиять на рейтинг прохождения или эпилог.

Если сцена завершает квест (дело), можно прямо в ней вызвать complete_quest (если есть действие) или через флаг, по которому бэкенд понимает завершение. Согласно текущей архитектуры, квесты могут автоматически завершаться, когда все задачи отмечены. Поэтому правильно формулируем задачи: напр. задачи “Найти X улик (флаги)”, “Вычислить преступника (флаг)”. Когда флаг преступник разоблачён выставлен, квест закрывается, выдается награда (опыт, репутация).

Балансировка и тестирование:

Протестировать, что карта Фрайбурга корректно отображается, точки на ней имеют нужные названия и появляются по мере игры (не все сразу). При необходимости отрегулировать радиус проксимити-триггеров (если решите использовать triggerType proximity для каких-то сцен – например, автоматическое обнаружение чего-то при приближении к точке).

Проверить, что QR-скан работает для всех добавленных улик: отсканировав код, игрок получает ожидаемый результат (сцену или сообщение). В логах сервера убедиться, что activate-qr возвращает правильный actions[]. Исправить опечатки в payload, если какие-то не совпадут.

Убедиться, что голоса-методы сбалансированы: не дают слишком много подсказок по сравнению с тем, что игрок может сам догадаться, и что при низких значениях игра не становится непроходимой. Возможно, настроить уровни требований низко, чтобы большинство игроков видели ключевые подсказки (не делать проверку Logic 10 для главной улики, иначе те, кто не прокачал Логику, вообще могут остаться в тупике). Хорошая практика – критические улики выдавать безусловно, а дополнительные – через навыки.

Посмотреть, как работает репутация фракций: например, если много помогать Подполью, не злятся ли Полицейские NPC? Это можно реализовать прямо в диалогах (разные реплики при высокой/низкой репутации) или через изменённые цены услуг (в оригинале, возможно, репутация влияет на цены торговли, тут можно влиять на готовность помогать или на доступ к определенным сценам).

Если боевая система включена: протестировать, все ли карты и враги настроены (можно временно сделать отладочный вызов start_tutorial_battle с вашим сценарием врага, чтобы сыграть бой). Проверить визуально соответствие (иконки, названия приёмов).

Подача повествования: Важный момент – лог книг/дневник. В оригинале, вероятно, есть журнал квестов. Убедитесь, что текстовое описание квеста (дела) понятно ведет игрока. Для детектива стоит добавлять записи “Что мы узнали” после каждого шага. Возможно, сделать раздел “Улики” в UI, где перечислены найденные доказательства (это можно реализовать через подсистему Codex или просто как часть описания квеста). Такие мелочи сильно повышают восприятие детективного жанра, позволяя игроку самому пересматривать улики и строить догадки.

В итоге, новая сюжетная линия «Фрайбург: Нити преступления» органично встроится в существующий каркас. Движок позволяет сосредоточиться на истории, не беспокоясь о технической базе. Геолокационная составляющая добавит уникальный слой погружения: игрок будет расследовать преступления, буквально гуляя по современному Фрайбургу, а игра будет превращать окружающие реалии в декорации столетней давности. Благодаря уже реализованным технологиям (AR-синхронизация с картой, внутренние голоса, нелинейные диалоги) вы сможете создать не просто квест, а иммерсивный детективный роман, где город раскрывает свои тайны на каждом углу. Удачи в разработке!

Ссылки на исходные системы проекта: Визуальная новелла, карта, инвентарь, квесты; «Внутренний парламент» 18 голосов; пресет региона Фрайбург; QR-триггеры и действия (разблокировка точек, VN-сцены, репутация и др.); пример привязки сцены к точке через QR.