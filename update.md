# Grezwanderer 4 — Журнал обновлений (Changelog)

Все значимые изменения и этапы разработки проекта фиксируются здесь.

---

## [26.01.2026] — Фокус на Detective Mode

### Удалено
- **Survival Mode**: Полное удаление режима выживания и всех упоминаний о нём для фокусировки на детективном геймплее.
- **Инвентарь выживания**: Из `useInventoryStore` удалены поля и логика, специфичные для режима выживания.

### Изменено
- **Главная страница**: Редизайн с упором на единственную доступную кампанию "Freiburg 1905".
- **Сканер (Hardlinks)**: Теперь работает исключительно в детективном режиме, интерфейс стилизован под архивную тематику.
- **Карта**: Упрощена логика рендеринга, удалены проверки переключения режимов.

---

## [26.01.2026] — Стабилизация и визуальное обновление (Detective Mode)

### Добавлено
- **Унифицированный запуск**: Добавлен скрипт `bun run dev`, запускающий Web и Server параллельно.
- **Система Онбординга (Telegram)**: Тематическое введение в стиле телеграммы 1905 года для Detective Mode.
- **Фоновая загрузка карты**: Mapbox инициализируется в фоне под блюром во время онбординга.
- **Персистентность имени**: Inspector Name сохраняется в `useInventoryStore` (localStorage).
- **Архитектурная документация**: Создан `ARCHITECTURE.md` с описанием слоев FSD и механик.
- **Visual Novel Engine**: Легковесный движок (`entities/visual-novel`) с поддержкой выборов и действий.
- **Case #1 "Bankhaus Krebs"**: Реализован полный сюжетный цикл (5 сценариев: Briefing → Bank → Pub → Archive → Warehouse).
- **Интерактивные выборы**: Ответы в диалогах теперь открывают точки на карте и выдают улики.
- **Автоматизация (Plop.js + Husky)**: Генераторы для FSD и пре-коммит хуки для проверки кода.

### Исправлено
- **Контекстный UI Досье**: Компонент `Dossier` перенесен внутрь `MapView`.
- **Accessibility & UX**: Исправлены а11y-лейблы и увеличены области клика (Fitts' Law) в телеграмме.
- **Module Resolution**: Фикс импортов `react-map-gl/mapbox` и `verbatimModuleSyntax`.
- **Layout Logic**: Исправлена высота карты (`100%`) и навигация при отказе от дела.

### Технические детали
- Обновлен `useInventoryStore` (state: `playerName`).
- Валидация через `ux_audit.py`, `accessibility_checker.py` и `lint_runner.py`.



---
### Архитектурный план (Next Steps)
- **MapPoint Engine 2.0**: Переход на единую систему точек (MapPoint + Binding + Conditions DSL).
- **Navigation**: Интеграция реальной навигации по дорогам (Infrastructure-aware proxy).
- **Narrative Threads**: Визуализация связей между уликами на карте.
- **Server Authority**: Подготовка к полной синхронизации прогресса расследований.

---

## [26.01.2026] — Asset Suite & Visual Consistency

### Добавлено
- **Detective Asset Suite**: Набор из 11+ тематических ассетов в `public/images/detective` (архивные фото, маркеры-печати, штампы "Erledigt").
- **Circular Map Pins**: В `DetectiveMapPin.tsx` реализована логика отображения фото-локаций в круглых рамках с золотым свечением.
- **Generic Markers**: Система иконок для типов точек (Crime: Seal, Support: Anvil, Info: Inkblot).

### Изменено
- **Filename Normalization**: Все сгенерированные ассеты переименованы в чистый формат (без timestamp) для соответствия коду.
- **Tooltip Styling**: Тултипы меток на карте приведены к общему стилю (темный фон, Serif шрифт, увеличенный трекинг).

### Технические детали
- Реализован приоритет `point.image` над дефолтными иконками в `DetectiveMapPin`.
- Улучшена обработка состояний (unlocked/investigated/discovered) через CSS-фильтры (sepia/grayscale).


---

## [26.01.2026] — Внутренний Парламент (Internal Parliament)

### Добавлено
- **Система 18 голосов**: Реализована полная структура «Внутреннего парламента» (6 групп по 3 голоса) согласно `Обзор.md`.
- **Метаданные Голосов**: Создана база данных голосов (`parliament.ts`) с уникальными цветами, девизами и типами (Интеллект, Психика и др.).
- **Прогрессия навыков**: В `useInventoryStore` добавлена персистентная система уровней для каждого из 18 голосов.
- **Интерактивный Досье**: Новая вкладка **"Voices"** в компоненте `Dossier` для визуализации прокачки навыков сыщика.

### Изменено
- **Динамический CaseCard**: Теперь карточки на карте отображают комментарии от любых из 18 голосов, используя их тематические цвета.
- **Миграция данных**: Все существующие игровые точки переведены со старой системы (Rationalist/Romantic) на новые ID голосов (`logic`, `empathy`).

### Технические детали
- Добавлен `parliament.ts` в корень и в `features/detective/lib` для синхронизации логики.
- Исправлены ошибки типизации и отсутствующие зависимости (`zustand` в корне).
- Реализована динамическая фильтрация и рендеринг голосов в UI на основе метаданных.

---
*Следующий этап: Интеграция проверок навыков (Skillchecks) в диалоговую систему.*

