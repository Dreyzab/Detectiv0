# Grezwanderer 4 ‚Äî –ñ—É—Ä–Ω–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (Changelog)

–í—Å–µ –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —ç—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∑–¥–µ—Å—å.

---

## [01.02.2026] - Dialogue Duels Migration (FSD + Immer)

### Added
- **Immer Integration**: Store rewritten with `produce()` for immutable state updates.
- **VisualEvent System**: Floating text animations for damage, heal, block, buff.
- **Web Audio API Sounds**: Procedural synth sounds (no external audio files):
    - **Damage**: Low-frequency thud
    - **Block**: Mechanical click
    - **Heal**: Warm D3 swell
    - **Buff**: High shimmer slide
- **Drag-to-Play**: Cards can be dragged to play zone (top 60% of screen).
- **Enemy Intent**: Bubble showing opponent's next card and effect.
- **FSD UI Components**:
    - `entities/battle/ui/Card.tsx` ‚Äî Card with group colors and effect icons
    - `entities/battle/ui/UnitStatus.tsx` ‚Äî Avatar, resolve bar, block badge
    - `entities/battle/ui/FloatingText.tsx` ‚Äî Animated numbers with sound

### Changed
- **BattleScenario**: Added `difficulty`, `opponentAvatar`, `playerStartingDeck` fields.
- **Turn Flow**: `cardsPerTurn` reduced to 2 for better pacing.
- **Store Types**: Added `TurnPhase`, `VisualEvent`, `PlayerEntity`, `OpponentEntity`.

### Technical
- **Dependencies**: Added `immer@11.1.3`
- **Barrel Exports**: Updated `entities/battle/index.ts` with UI components

---

## [01.02.2026] - VN Flow & FSD UI Refactor

### Added
- FSD relocation of VN UI: `TypedText` -> `shared/ui`, `SpeakerBadge` -> `entities/character/ui`, `VisualNovelOverlay` + `MobileVNLayout` -> `widgets/visual-novel`.

### Changed
- Fullscreen VN starts only from MapPoint interactions (`start_vn` -> `/vn/:id`).
- Fullscreen VN exits to `/map` to create a hard break between scenes.

### Fixed
- Removed overlay auto-navigation that caused scenario chaining.
- Fixed a `MapView` zustand selector causing infinite update depth.

## [01.02.2026] ‚Äî Dialogue Battle System ‚öîÔ∏è

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–ö–∞—Ä—Ç–æ—á–Ω–∞—è –±–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –í–µ—Ä–±–∞–ª—å–Ω—ã–µ –¥—É—ç–ª–∏ –≤ —Å—Ç–∏–ª–µ Griftlands –¥–ª—è –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏—è NPC.
    - **15 —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç** –ø–æ 6 –∞—Ç—Ä–∏–±—É—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º:
        - üîµ Intellect: Logical Argument, Analyze Weakness, Brilliant Deduction
        - üü£ Psyche: Empathic Appeal, Gut Feeling, Read Intent
        - üî¥ Social: Assertive Stance, Silver Tongue, Commanding Presence
        - üü¢ Physical: Steady Nerves, Relentless
        - ‚ö´ Shadow: Misdirection, Veiled Threat
        - üü† Spirit: Appeal to Tradition, Poetic Strike
    - **Resolve System**: –ê–Ω–∞–ª–æ–≥ HP ‚Äî —Å–Ω–∏–∂–∞–π—Ç–µ —Ä–µ—à–∏–º–æ—Å—Ç—å –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏.
    - **–≠—Ñ—Ñ–µ–∫—Ç—ã –∫–∞—Ä—Ç**: Damage, Block, Heal, Draw, Gain AP.
    - **Action Points**: 3 AP –∑–∞ —Ö–æ–¥, –∫–∞—Ä—Ç—ã —Å—Ç–æ—è—Ç 1-3 AP.
    - **Simple AI**: –û–ø–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—ã–≥—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—ã –∫–∞–∂–¥—ã–π —Ö–æ–¥.
- **Battle Store (Zustand)**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±–æ—è (—Ä—É–∫–∏, –∫–æ–ª–æ–¥—ã, —Å–±—Ä–æ—Å, —Ö–æ–¥—ã).
- **Deck Utilities**: –£—Ç–∏–ª–∏—Ç—ã shuffle, draw, discard –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–ª–æ–¥–∞–º–∏.
- **Battle Page UI**: –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å ResolveBar, CardHand (—Ü–≤–µ—Ç–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º), AP pips, BattleLog.
- **2 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è**: `detective_skirmish` (Merchant) –∏ `detective_boss_krebs` (Krebs).
- **Routing**: –ú–∞—Ä—à—Ä—É—Ç `/battle` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ VN flow.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **Type Fix**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ `battleId` ‚Üí `scenarioId` –≤ `map-validators.ts`.
- **VN Navigation**: `VisualNovelOverlay` –∏ `VisualNovelPage` —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ `/battle`.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Schema**: `packages/shared/data/battle.ts` ‚Äî CardDefinition, BattleScenario, —ç—Ñ—Ñ–µ–∫—Ç—ã.
- **Store**: `apps/web/src/entities/battle/model/store.ts` ‚Äî Zustand —Å –ª–æ–≥–∏–∫–æ–π —Ö–æ–¥–æ–≤ –∏ AI.
- **UI**: `apps/web/src/pages/BattlePage/` ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏ CSS.

---

## [01.02.2026] ‚Äî UI Pro Max: Glassmorphism & Parallax

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Virtual Window (Gyroscope)**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —ç—Ñ—Ñ–µ–∫—Ç "–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞" –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
    - –§–æ–Ω (Background) –ø–∞–Ω–æ—Ä–∞–º–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∫–ª–æ–Ω–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (DeviceOrientation API).
    - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Lerp (Linear Interpolation).
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iOS Permissions API (–∑–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞—Ç—á–∏–∫–∞–º).
- **Cinematic Reveal**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (HUD) –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ü–µ–Ω—ã.
    - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–∫–Ω–æ –ø–ª–∞–≤–Ω–æ —É–µ–∑–∂–∞–µ—Ç –≤–Ω–∏–∑, –æ—Ç–∫—Ä—ã–≤–∞—è –ø–æ–ª–Ω—ã–π –∞—Ä—Ç –ª–æ–∫–∞—Ü–∏–∏.
    - –í–æ–∑–≤—Ä–∞—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ –∫–ª–∏–∫—É –≤ –ª—é–±—É—é —á–∞—Å—Ç—å —ç–∫—Ä–∞–Ω–∞.
- **Glassmorphism UI (Mobile)**: –ü–æ–ª–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∏–∑–∞–π–Ω –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–æ–≤–µ–ª–ª—ã (`MobileVNLayout`).
    - **Asymmetrical Layout**: –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ —Å —Ä–∞–∑–º—ã—Ç–∏–µ–º (Backdrop Blur).
    - **Connected Speaker Badge**: –ü–ª–∞–≤–∞—é—â–∏–π –±–µ–π–¥–∂ –≥–æ–≤–æ—Ä—è—â–µ–≥–æ, "–ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π" –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –±–ª–æ–∫—É –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –ª–∏–Ω–∏–µ–π.
    - **Inline Choices**: –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä—è–º–æ –≤ –ø–æ—Ç–æ–∫ –¥–∏–∞–ª–æ–≥–∞ (–∫–∞–∫ —Å–ø–∏—Å–æ–∫), –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏.
- **Micro-Animations**:
    - **Typing Indicator**: –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä—Å–æ—Ä "Continue" –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–µ—á–∞—Ç–∏.
    - **Choice Reveal**: –ö–∞—Å–∫–∞–¥–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ (`staggerChildren`).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Refactoring**: –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞ –≤ `MobileVNLayout.tsx` –∏ `useGyroParallax.ts`.
- **Performance**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `will-change-transform` –¥–ª—è —Ñ–æ–Ω–∞ –∏ `requestAnimationFrame` –¥–ª—è –≥–∏—Ä–æ—Å–∫–æ–ø–∞.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **Scenario Architecture (Case Bundles)**: –ü–æ–ª–Ω–∞—è —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –ø–∞–ø–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (`scenarios/detective`).
    - **Case 01 Bundle**: –í—Å–µ —Ñ–∞–π–ª—ã –î–µ–ª–∞ ‚Ññ1 —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ `case_01_bank` —Å –ø–æ–¥–ø–∞–ø–∫–∞–º–∏ `main/` (—Å—é–∂–µ—Ç) –∏ `leads/` (–≤–µ—Ç–∫–∏ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è).
    - **Side Quests**: –ü–æ–±–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `side_quests/` (Lotte, Victoria, Inspector).
    - **Clean Exports**: –í–Ω–µ–¥—Ä–µ–Ω—ã `index.ts` —Ñ–∞–π–ª—ã –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

---

## [31.01.2026] ‚Äî Parliament Keyword System Fix & Expansion

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **Keyword Visibility**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Z-Index –∫–æ–Ω—Ñ–ª–∏–∫—Ç (`ParliamentKeywordCard`), –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–∫—Ä—ã–≤–∞–ª–∏—Å—å –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –Ω–æ–≤–µ–ª–ª—ã. –¢–µ–ø–µ—Ä—å –æ–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–≤–µ—Ä—Ö (`z-[300]`).
- **Overlay Integration**: –í `VisualNovelOverlay` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤. –¢–µ–ø–µ—Ä—å –∫–ª–∏–∫ –ø–æ `[[keyword]]` –≤ —Ä–µ–∂–∏–º–µ –∫–∞—Ä—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—É –∂–µ –∫–∞—Ä—Ç–æ—á–∫—É –ø–∞—Ä–ª–∞–º–µ–Ω—Ç–∞, —á—Ç–æ –∏ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ.

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Action System Plan**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–æ–Ω—Ü–µ–ø—Ç (`PLAN-mechanics.md`) –¥–ª—è –±—É–¥—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã "Action Keywords", –≥–¥–µ –∫–ª–∏–∫ –ø–æ —Ç–µ–∫—Å—Ç—É —Å–º–æ–∂–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –∏–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (—Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤), –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–æ—Ä.

---

## [29.01.2026] ‚Äî "The Open City" & Narrative Polish

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Case 1 Complete Implementation**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å—Ü–µ–Ω–∞—Ä–Ω–∞—è –≤–µ—Ç–∫–∞ "Bankhaus Krebs".
    - **Interludes**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å—Ü–µ–Ω—ã A (Victoria Street Event) –∏ B (Lotte Phone Call) —Å –ø–æ–ª–Ω–æ–π –æ–∑–≤—É—á–µ–Ω–Ω–æ–π (—Ç–µ–∫—Å—Ç–æ–≤–æ) –¥—Ä–∞–º–æ–π.
    - **Hybrid Finale**: –§–∏–Ω–∞–ª —Å –¥–≤—É–º—è —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ç–∫–∞–º–∏: "Political Provocation" (—Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ –∫–æ—Ä—Ä—É–ø—Ü–∏–∏) –∏ "Syndicate War" (–ø–µ—Ä–µ—Å—Ç—Ä–µ–ª–∫–∞).
    - **Personal Quest**: –í–Ω–µ–¥—Ä–µ–Ω –∫–≤–µ—Å—Ç –í–∏–∫—Ç–æ—Ä–∏–∏ "The Golden Cage" (—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤ –ø–∞–±), –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–ª—é–¥–∏—é.
- **Audio System**:
    - **SoundManager**: –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—É–∫–∞ –Ω–∞ Web Audio API.
    - **Typewriter FX**: –ö–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –≤ –¥–∏–∞–ª–æ–≥–µ —Ç–µ–ø–µ—Ä—å –∏–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–π —â–µ–ª—á–æ–∫ (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö mp3 —Ñ–∞–π–ª–æ–≤).
    - **Ambient Support**: –ü–ª–∞–≤–Ω—ã–π –∫—Ä–æ—Å—Å—Ñ–µ–π–¥ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ü–µ–Ω.
- **Interactive Feedback**:
    - **Toast Notifications**: –°—Ç–∏–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Art Deco) –ø—Ä–∏ —Å–±–æ—Ä–µ —É–ª–∏–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–æ–∫.
    - **Animated Tokens**: –£–ª–∏–∫–∏ –∏ –∏–Ω—Å–∞–π—Ç—ã —Ç–µ–ø–µ—Ä—å –ø—É–ª—å—Å–∏—Ä—É—é—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∏ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω—ã (Framer Motion).
- **Aesthetic Overhaul (Detective's Desk)**:
    - **Color Palette**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ç–µ–ø–ª—É—é —Å—Ö–µ–º—É "Warm Black / Gold / Amber" (#d4c5a3, #1c1917, #b45309).
    - **Typography**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ **Playfair Display** (Dialogue/Headers) –∏ **Courier Prime** (Clues/Reports).

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **Logic<>Gameplay Sync**: –°–±–æ—Ä —É–ª–∏–∫ –≤ —Ç–µ–∫—Å—Ç–µ (`[[id|text]]`) —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–≥—Ä–æ–≤—ã–µ —Ñ–ª–∞–≥–∏, –æ—Ç–∫—Ä—ã–≤–∞—è –Ω–æ–≤—ã–µ –≤–µ—Ç–∫–∏ –¥–∏–∞–ª–æ–≥–æ–≤.
- **Registry Update**: –í—Å–µ –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Interludes, Finale, Quests) –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ç–æ—á–∫–∞–º –∫–∞—Ä—Ç—ã.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Type Definitions**: –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã `VNScenario` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `musicUrl`.
- **Refactoring**: –û—á–∏—Å—Ç–∫–∞ `VisualNovelOverlay` –æ—Ç —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –≤ –ø–æ–ª—å–∑—É CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ–º—ã.

---

## [28.01.2026] ‚Äî Hybrid Quest System & Developer Tools

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Hybrid Quest Engine**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–≤–µ—Å—Ç–æ–≤, —Å–æ—á–µ—Ç–∞—é—â–∞—è –ª–∏–Ω–µ–π–Ω—ã–µ –∞–∫—Ç—ã (Acts/Cases) —Å –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–º –≥—Ä–∞—Ñ–æ–º —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
    - **Schema**: –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã `quests` –∏ `user_quests`.
    - **QuestStore**: –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–≤–µ—Å—Ç–æ–≤ –∏ —Ü–µ–ª–µ–π.
    - **QuestLog Interface**: –ù–æ–≤—ã–π –æ–≤–µ—Ä–ª–µ–π-–≤–∏–¥–∂–µ—Ç (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ü–µ–ª–µ–π.
    - **Engine Hook**: `useQuestEngine` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥–∏ –≤ `DossierStore` –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–æ–≤.
- **Developer Dashboard 2.0**: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ `/developer`.
    - **Quests Tab**: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–µ—Å—Ç—Ä–∞ –∫–≤–µ—Å—Ç–æ–≤, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤.
    - **Interactive Debuggers**:
        - **Flags Manager**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (toggle) –∑–Ω–∞—á–µ–Ω–∏–π –∏ —É–¥–∞–ª–µ–Ω–∏–µ.
        - **Stats Editor**: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ 18 –≥–æ–ª–æ—Å–∞–º–∏ (Parliament) —á–µ—Ä–µ–∑ +/- –∫–Ω–æ–ø–∫–∏.
        - **Traits Manager**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∫–æ–≤ –≤—Ä—É—á–Ω—É—é.
    - **System Actions**: –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–¥–∞—á–∏ –æ–ø—ã—Ç–∞ –∏ –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (Factory Reset).
    - **Visualization**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ XP –Ω–∞–≤—ã–∫–æ–≤ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö Dev Points.
- **Quest System Improvements**:
    - **Quest Reset**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "Reset Quests" –≤ –ø–∞–Ω–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –∫–≤–µ—Å—Ç–æ–≤ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
    - **Bug Fixes**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å `DossierStore` –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ —Å–±–æ—Ä–∫–µ.
- **Hybrid Progression System (v2.0)**:
    - **Usage-Based Logic**: –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤—ã–∫–∞ (Logic, Empathy –∏ —Ç.–¥.) –¥–∞–µ—Ç XP —ç—Ç–æ–º—É –Ω–∞–≤—ã–∫—É.
        - –£—Å–ø–µ—Ö: +20 XP.
        - –ü—Ä–æ–≤–∞–ª: +10 XP (Learning from failure).
    - **Classic Leveling**: –û–±—â–∏–π XP –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–∑–∞ –∫–≤–µ—Å—Ç—ã) –ø–æ–≤—ã—à–∞–µ—Ç "Character Rank".
    - **Development Points**: –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–Ω–≥–∞ –¥–∞–µ—Ç 1 Dev Point –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–≤—ã—à–µ–Ω–∏—è –ª—é–±–æ–≥–æ –Ω–∞–≤—ã–∫–∞.
    - **Character Page**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω UI. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –Ω–∞–≤—ã–∫–æ–≤, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç—Ä–∞—Ç—ã –æ—á–∫–æ–≤.
- **Progression System**:
    - –í `DossierStore` –¥–æ–±–∞–≤–ª–µ–Ω—ã `xp`, `level` –∏ `traits`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ `grantXp` —Å –ø—Ä–æ—Å—Ç—ã–º –ª–µ–≤–µ–ª–∏–Ω–≥–æ–º (1 —É—Ä–æ–≤–µ–Ω—å –∑–∞ 1000 XP).

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **UI Integration**: `App.tsx` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç `QuestLog` –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `QuestEngine`.
- **Refactoring**: –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ —Å—Ç–æ—Ä–∞—Ö.

---

## [28.01.2026] ‚Äî Database Migration (Map Points v2)

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Schema Extension**: –í —Ç–∞–±–ª–∏—Ü—É `map_points` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `description`, `category` (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã: `CRIME_SCENE | NPC | QUEST | EVENT | ACTIVITY | INTEREST | TRAVEL`), `image` (–ø—Ä—è–º–æ–π –ø—É—Ç—å –∫ –∞—Å—Å–µ—Ç—É).
- **Seed Script v2**: –û–±–Ω–æ–≤–ª—ë–Ω `seed-map.ts` –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è (–Ω–µ JSON).
- **Category Mapping**: `DetectiveMapPin.tsx` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤—ã–µ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–∞–∫ –∏ legacy —Ç–∏–ø—ã (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å).

### –£–¥–∞–ª–µ–Ω–æ
- **Legacy Points**: –£–¥–∞–ª—ë–Ω —Ñ–∞–π–ª `packages/shared/data/points.ts` (—Ö–∞—Ä–¥–∫–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏).
- **Feature Flag**: –£–¥–∞–ª—ë–Ω `ENABLE_LEGACY_MAP_POINTS` ‚Äî –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –∏–∑ –ë–î.
- **Hybrid Merge**: –ò–∑ `useMapPoints.ts` —É–¥–∞–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–ª–∏—è–Ω–∏—è legacy + server –¥–∞–Ω–Ω—ã—Ö.

- **Client Code**: `useMapPoints.ts` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 85 –¥–æ 40 —Å—Ç—Ä–æ–∫ (—Ç–æ–ª—å–∫–æ API fetch).
- **Resolver**: `resolveAvailableInteractions` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç `bindings` –∫–∞–∫ JSON-—Å—Ç—Ä–æ–∫—É –∏–∑ –ë–î.

### Character Page & Parliament Refactor
- **Character Page**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (`/character`) –≤ —Å—Ç–∏–ª–µ Art Deco / "Detective's Desk".
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ 18 –≥–æ–ª–æ—Å–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ 6 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (Intellect, Psyche, Social, Physical, Shadow, Spirit).
    - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è –∏ –æ–ø—ã—Ç–∞.
    - –ë–∏–æ–≥—Ä–∞—Ñ–∏—è –∏ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–∞.
- **Parliament System**: –ü–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –ø–æ–¥ —Å–∏—Å—Ç–µ–º—É 18 –≥–æ–ª–æ—Å–æ–≤.
    - `DossierStore` —Ç–µ–ø–µ—Ä—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Å–µ—Ö 18 –Ω–∞–≤—ã–∫–æ–≤.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ `parliament.ts` (re-export –∏–∑ `@repo/shared`).
    - –ò–∫–æ–Ω–∫–∏: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã 5 –±–∞–∑–æ–≤—ã—Ö –∏–∫–æ–Ω–æ–∫ Art Deco –¥–ª—è –≥—Ä—É–ø–ø –Ω–∞–≤—ã–∫–æ–≤.
- **Build Fixes**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `MapPointSchema` (–¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `image`).
    - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π –≤ `CaseCard` –∏ `DetectiveMapPin`.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
| –î–æ–º–µ–Ω | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç—É—Å |
|-------|----------|--------|
| Map Points | SQLite | ‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ |
| User Progress | SQLite | ‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ |
| Hardlinks | `hardlinks.ts` | ‚è≥ –§–∞–∑–∞ 2 |
| Cases | `cases.ts` | ‚è≥ –§–∞–∑–∞ 2 |
| Deductions | `deductions.ts` | ‚è≥ –§–∞–∑–∞ 2 |

> **–ü–ª–∞–Ω**: `hardlinks.ts`, `cases.ts`, `deductions.ts` –º–∏–≥—Ä–∏—Ä—É—é—Ç –≤ –ë–î –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Content Editor.

---

## [27.01.2026] ‚Äî Localization 2.0 & Unified Navbar

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Localization Engine 2.0**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è (`Logic`) –∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`Content`).
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤: **English (EN)**, **Deutsch (DE)**, **–†—É—Å—Å–∫–∏–π (RU)**.
    - –°–∏—Å—Ç–µ–º–∞ `mergeScenario`: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ —Å—Ü–µ–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–æ–ª–ª–±—ç–∫–æ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞.
    - –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ `[[—É–ª–∏–∫–∞|—Ç–µ–∫—Å—Ç]]` —á–µ—Ä–µ–∑ –ø–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π –æ–±—Ö–æ–¥.
- **Premium Navbar (The Detective's Desk)**: –ù–æ–≤–∞—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞.
    - –î–∏–∑–∞–π–Ω: –°—Ç–∏–ª—å **Art Deco / Liquid Glass** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∑–æ–ª–æ—Ç–æ–π –æ—Ç–¥–µ–ª–∫–∏ (#CA8A04), —Ç–µ–∫—Å—Ç—É—Ä –¥–µ—Ä–µ–≤–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–∞–∑–º—ã—Ç–∏—è.
    - **Integrated HUD**: –í Navbar –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (Investigation) –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞.
    - **Global Navigation**: –ü—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –î–æ—Å—å–µ (Dossier) –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º.
- **Dossier Visibility Control**: –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `isDossierOpen` –≤ `DossierStore`, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∂—É—Ä–Ω–∞–ª–æ–º –∏–∑ –ª—é–±–æ–π —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **Cleanup**: –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–ª–∞–≤–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `MapHUD` –∏ `LocaleSelector`.
- **Imports Optimization**: –û—á–∏—â–µ–Ω `MapView.tsx` –æ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –ª–µ–≥–∞—Å–∏-–ª–æ–≥–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI.
- **Parliament Registry**: –í `parliament.ts` –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø –≥–æ–ª–æ—Å–æ–≤ (Rational, Emotional, Mystical) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –≤ –î–æ—Å—å–µ.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **i18n Schema**: –í–Ω–µ–¥—Ä–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è —è–∑—ã–∫–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∞—è –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–π –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
- **Z-Index Refactoring**: –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏—è —Å–ª–æ–µ–≤: Navbar (300) > Overlay (200) > Fullscreen (180) > Dossier (150) > Map.

---


## [27.01.2026] ‚Äî Detective Notebook & Dual-Mode Engine

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Detective Notebook Mechanic**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–º–µ—Ç–æ–∫. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `[[—Ç–µ–∫—Å—Ç]]` (–ó–∞–º–µ—Ç–∫–∞) –∏ `[[id|—Ç–µ–∫—Å—Ç]]` (–£–ª–∏–∫–∞) –≤ —Ç–µ–∫—Å—Ç–∞—Ö –Ω–æ–≤–µ–ª–ª—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥—Ä–æ–∫—É –∫–ª–∏–∫–æ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –î–æ—Å—å–µ.
- **Dual-Mode VN Engine**: –î–≤–∏–∂–æ–∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª—ã —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
    - **Overlay**: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–∫–Ω–æ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç—ã (–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–π).
    - **Fullscreen**: –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å—é–∂–µ—Ç–Ω—ã—Ö —Ä–∞–∑–≤—è–∑–æ–∫ (Finale).
- **Notebook Widget**: –ù–æ–≤—ã–π UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–≤–∏–¥–∂–µ—Ç) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–±—Ä–∞–Ω–Ω—ã–º –∑–∞–º–µ—Ç–∫–∞–º –∏ —É–ª–∏–∫–∞–º –ø—Ä—è–º–æ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–∞—Ä—Ç—ã.
- **Case #1 Content Complete**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏ –î–µ–ª–∞ ‚Ññ1 "Bankhaus Krebs":
    - *Bank Scene*: –û—Å–º–æ—Ç—Ä –º–µ—Å—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è (Overlay).
    - *Lab Analysis*: –ê–Ω–∞–ª–∏–∑ —É–ª–∏–∫ –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ (Overlay).
    - *Finale*: –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–µ–¥—É–∫—Ü–∏—è –∏ –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏—è (Fullscreen).

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **TypedText Parser**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `TypedText` —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏ –∏ –ø–∞—Ä—Å–∏–Ω–≥–æ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤.
- **Strict Typing**: –í–Ω–µ–¥—Ä–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è `VoiceId` (Internal Parliament) –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ `registry.ts`.
- **Dossier Upgrade**: `DossierStore` —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∑–∞–º–µ—Ç–æ–∫ –∏ —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é —Ç–∏–ø–æ–≤ –∑–∞–ø–∏—Å–µ–π (`note` vs `clue`).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Unit Tests**: –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞ `TypedText` (Vitest/JSDOM).
- **Registry Pattern**: –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º `SCENARIO_REGISTRY` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Database Schema**: –¢–∞–±–ª–∏—Ü—ã `map_points` (—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ—á–µ–∫) –∏ `user_map_point_states` (–ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä–æ–∫–∞) –≤ SQLite.
- **Seeding Script**: –°–∫—Ä–∏–ø—Ç `seed-map.ts` –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î.
- **MapPointCard**: –ù–æ–≤—ã–π UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ—á–∫–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (Actions).
- **ThreadLayer 2.0**: –°–ª–æ–π –Ω–∏—Ç–µ–π —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ (data-driven), —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **Refactoring**: –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ª–µ–≥–∞—Å–∏-–∫–æ–¥–∞ `DETECTIVE_POINTS` –∏–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏.
- **Cleanup**: –£–¥–∞–ª–µ–Ω —Ñ–ª–∞–≥ `ENABLE_LEGACY_MAP_POINTS` –∏ –≥–∏–±—Ä–∏–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–ª–∏—è–Ω–∏—è.
- **Performance**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–ª–æ–µ–≤ –∫–∞—Ä—Ç—ã (—É–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Validation**: Zod-—Å—Ö–µ–º—ã –¥–ª—è JSON-–±–∏–Ω–¥–∏–Ω–≥–æ–≤ (Triggers, Conditions, Actions) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î.
- **Idempotency**: API –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–æ—á–µ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π.

---

## [27.01.2026] ‚Äî RPG Mechanics & Skill Checks

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Dice Logic Core**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `dice.ts` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞–≤—ã–∫–æ–≤ (d20 roll + skill level vs Difficulty).
- **Store Upgrade**: `DossierStore` —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç `voiceStats` (—É—Ä–æ–≤–Ω–∏ –Ω–∞–≤—ã–∫–æ–≤) –∏ `checkStates` (–∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫: passed/failed/locked).
- **Skill Check Schema**: –†–∞—Å—à–∏—Ä–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `VNChoice` –æ–±—ä–µ–∫—Ç–æ–º `skillCheck`, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å, —Ç–∏–ø –≥–æ–ª–æ—Å–∞ (Logic, Perception –∏ —Ç.–¥.) –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è (onSuccess/onFail).
- **Interactive UI**: `VisualNovelOverlay` —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±—Ä–æ—Å–∫–∏ –∫—É–±–∏–∫–æ–≤, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—è –∏–≥—Ä–æ–∫–∞ –ø–æ –≤–µ—Ç–∫–∞–º —É—Å–ø–µ—Ö–∞ –∏–ª–∏ –ø—Ä–æ–≤–∞–ª–∞.
- **Content Integration**: –í —Å—Ü–µ–Ω–∞—Ä–∏–π Case #1 (Bank Vault) –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Logic: –≤–∑–ª–æ–º –∑–∞–º–∫–∞, Perception: –ø–æ–∏—Å–∫ —É–ª–∏–∫) —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –∏—Å—Ö–æ–¥–∞–º–∏.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Shared Lib**: –õ–æ–≥–∏–∫–∞ –∫—É–±–∏–∫–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `packages/shared/lib/dice.ts` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
- **State Management**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ —á–µ—Ä–µ–∑ Zustand, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.
- **Schema Validation**: –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∏—Å—Ö–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–¥–µ–π—Å—Ç–≤–∏—è + –Ω–∞–≤–∏–≥–∞—Ü–∏—è).

### Planning (Architecture)
- **MapPoint Engine 2.0**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω (`docs/PLAN-map-point-types.md`) –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–æ—á–µ–∫.
  - **Single Source**: –û—Ç–∫–∞–∑ –æ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ hardcoded —Ç–æ—á–∫–∏ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ.
  - **Bindings DSL**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã "–¢—Ä–∏–≥–≥–µ—Ä -> –£—Å–ª–æ–≤–∏–µ -> –î–µ–π—Å—Ç–≤–∏–µ" (JSON-serializable).
  - **Lifecycle**: –ß–µ—Ç–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è `locked` -> `discovered` -> `visited` -> `completed`.

---

## [26.01.2026] ‚Äî –§–æ–∫—É—Å –Ω–∞ Detective Mode

### –£–¥–∞–ª–µ–Ω–æ
- **Survival Mode**: –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è –∏ –≤—Å–µ—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –Ω—ë–º –¥–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–æ–º –≥–µ–π–º–ø–ª–µ–µ.
- **–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –≤—ã–∂–∏–≤–∞–Ω–∏—è**: –ò–∑ `useInventoryStore` —É–¥–∞–ª–µ–Ω—ã –ø–æ–ª—è –∏ –ª–æ–≥–∏–∫–∞, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —Ä–µ–∂–∏–º–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: –†–µ–¥–∏–∑–∞–π–Ω —Å —É–ø–æ—Ä–æ–º –Ω–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é "Freiburg 1905".
- **–°–∫–∞–Ω–µ—Ä (Hardlinks)**: –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω –ø–æ–¥ –∞—Ä—Ö–∏–≤–Ω—É—é —Ç–µ–º–∞—Ç–∏–∫—É.
- **–ö–∞—Ä—Ç–∞**: –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞, —É–¥–∞–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤.

---

## [26.01.2026] ‚Äî –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (Detective Mode)

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫**: –î–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `bun run dev`, –∑–∞–ø—É—Å–∫–∞—é—â–∏–π Web –∏ Server –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
- **–°–∏—Å—Ç–µ–º–∞ –û–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (Telegram)**: –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ —Ç–µ–ª–µ–≥—Ä–∞–º–º—ã 1905 –≥–æ–¥–∞ –¥–ª—è Detective Mode.
- **–§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã**: Mapbox –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ –ø–æ–¥ –±–ª—é—Ä–æ–º –≤–æ –≤—Ä–µ–º—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞.
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏**: Inspector Name —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `useInventoryStore` (localStorage).
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω `ARCHITECTURE.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–ª–æ–µ–≤ FSD –∏ –º–µ—Ö–∞–Ω–∏–∫.
- **Visual Novel Engine**: –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –¥–≤–∏–∂–æ–∫ (`entities/visual-novel`) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—ã–±–æ—Ä–æ–≤ –∏ –¥–µ–π—Å—Ç–≤–∏–π.
- **Case #1 "Bankhaus Krebs"**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Å—é–∂–µ—Ç–Ω—ã–π —Ü–∏–∫–ª (5 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: Briefing ‚Üí Bank ‚Üí Pub ‚Üí Archive ‚Üí Warehouse).
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–±–æ—Ä—ã**: –û—Ç–≤–µ—Ç—ã –≤ –¥–∏–∞–ª–æ–≥–∞—Ö —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ –∏ –≤—ã–¥–∞—é—Ç —É–ª–∏–∫–∏.
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Plop.js + Husky)**: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è FSD –∏ –ø—Ä–µ-–∫–æ–º–º–∏—Ç —Ö—É–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞.

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π UI –î–æ—Å—å–µ**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `Dossier` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –≤–Ω—É—Ç—Ä—å `MapView`.
- **Accessibility & UX**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∞11y-–ª–µ–π–±–ª—ã –∏ —É–≤–µ–ª–∏—á–µ–Ω—ã –æ–±–ª–∞—Å—Ç–∏ –∫–ª–∏–∫–∞ (Fitts' Law) –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ.
- **Module Resolution**: –§–∏–∫—Å –∏–º–ø–æ—Ä—Ç–æ–≤ `react-map-gl/mapbox` –∏ `verbatimModuleSyntax`.
- **Layout Logic**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç—ã (`100%`) –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –æ—Ç –¥–µ–ª–∞.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `useInventoryStore` (state: `playerName`).
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `ux_audit.py`, `accessibility_checker.py` –∏ `lint_runner.py`.



---
### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω (Next Steps)
- **MapPoint Engine 2.0**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–æ—á–µ–∫ (MapPoint + Binding + Conditions DSL).
- **Navigation**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥–æ—Ä–æ–≥–∞–º (Infrastructure-aware proxy).
- **Narrative Threads**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —É–ª–∏–∫–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç–µ.
- **Server Authority**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π.

---

## [26.01.2026] ‚Äî Asset Suite & Visual Consistency

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Detective Asset Suite**: –ù–∞–±–æ—Ä –∏–∑ 11+ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞—Å—Å–µ—Ç–æ–≤ –≤ `public/images/detective` (–∞—Ä—Ö–∏–≤–Ω—ã–µ —Ñ–æ—Ç–æ, –º–∞—Ä–∫–µ—Ä—ã-–ø–µ—á–∞—Ç–∏, —à—Ç–∞–º–ø—ã "Erledigt").
- **Circular Map Pins**: –í `DetectiveMapPin.tsx` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ç–æ-–ª–æ–∫–∞—Ü–∏–π –≤ –∫—Ä—É–≥–ª—ã—Ö —Ä–∞–º–∫–∞—Ö —Å –∑–æ–ª–æ—Ç—ã–º —Å–≤–µ—á–µ–Ω–∏–µ–º.
- **Generic Markers**: –°–∏—Å—Ç–µ–º–∞ –∏–∫–æ–Ω–æ–∫ –¥–ª—è —Ç–∏–ø–æ–≤ —Ç–æ—á–µ–∫ (Crime: Seal, Support: Anvil, Info: Inkblot).

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **Filename Normalization**: –í—Å–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–µ—Ç—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ —á–∏—Å—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç (–±–µ–∑ timestamp) –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–¥—É.
- **Tooltip Styling**: –¢—É–ª—Ç–∏–ø—ã –º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –æ–±—â–µ–º—É —Å—Ç–∏–ª—é (—Ç–µ–º–Ω—ã–π —Ñ–æ–Ω, Serif —à—Ä–∏—Ñ—Ç, —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç `point.image` –Ω–∞–¥ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∏–∫–æ–Ω–∫–∞–º–∏ –≤ `DetectiveMapPin`.
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (unlocked/investigated/discovered) —á–µ—Ä–µ–∑ CSS-—Ñ–∏–ª—å—Ç—Ä—ã (sepia/grayscale).


---

## [26.01.2026] ‚Äî –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ü–∞—Ä–ª–∞–º–µ–Ω—Ç (Internal Parliament)

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–°–∏—Å—Ç–µ–º–∞ 18 –≥–æ–ª–æ—Å–æ–≤**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ¬´–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–∞—Ä–ª–∞–º–µ–Ω—Ç–∞¬ª (6 –≥—Ä—É–ø–ø –ø–æ 3 –≥–æ–ª–æ—Å–∞) —Å–æ–≥–ª–∞—Å–Ω–æ `–û–±–∑–æ—Ä.md`.
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ì–æ–ª–æ—Å–æ–≤**: –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤ (`parliament.ts`) —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏, –¥–µ–≤–∏–∑–∞–º–∏ –∏ —Ç–∏–ø–∞–º–∏ (–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç, –ü—Å–∏—Ö–∏–∫–∞ –∏ –¥—Ä.).
- **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è –Ω–∞–≤—ã–∫–æ–≤**: –í `useInventoryStore` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 18 –≥–æ–ª–æ—Å–æ–≤.
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –î–æ—Å—å–µ**: –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ **"Voices"** –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `Dossier` –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∫–∞—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ —Å—ã—â–∏–∫–∞.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π CaseCard**: –¢–µ–ø–µ—Ä—å –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ—Ç –ª—é–±—ã—Ö –∏–∑ 18 –≥–æ–ª–æ—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è –∏—Ö —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ü–≤–µ—Ç–∞.
- **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–≥—Ä–æ–≤—ã–µ —Ç–æ—á–∫–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã —Å–æ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã (Rationalist/Romantic) –Ω–∞ –Ω–æ–≤—ã–µ ID –≥–æ–ª–æ—Å–æ–≤ (`logic`, `empathy`).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –î–æ–±–∞–≤–ª–µ–Ω `parliament.ts` –≤ –∫–æ—Ä–µ–Ω—å –∏ –≤ `features/detective/lib` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏.
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`zustand` –≤ –∫–æ—Ä–Ω–µ).
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥–æ–ª–æ—Å–æ–≤ –≤ UI –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

---
---

## [26.01.2026] ‚Äî –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –∏ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –¥–æ—Å—å–µ (Lore)**: –°–æ–∑–¥–∞–Ω `–°—é–∂–µ—Ç.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –§—Ä–∞–π–±—É—Ä–≥–∞ 1905 –≥–æ–¥–∞. –í–∫–ª—é—á–∞–µ—Ç –ø—Å–∏—Ö–æ–≥–µ–æ–≥—Ä–∞—Ñ–∏—é —Ä–∞–π–æ–Ω–æ–≤ (–®–Ω–µ–∫–µ–Ω—Ñ–æ—Ä—à—Ç–∞–¥—Ç, –®—Ç—é–ª–∏–Ω–≥–µ—Ä), –∞–Ω–∞–ª–∏–∑ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞ –∏ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É (—Ç–µ—Å—Ç—ã –£–ª–µ–Ω–≥—É—Ç–∞, —Ö–∏–º–∏—è –ö–∏–ª–∏–∞–Ω–∏).
- **–°—Ü–µ–Ω–∞—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–ª—è ¬´–°–∞—Ö–∞—Ä–∏–Ω–æ–≤–æ–π –≤–æ–π–Ω—ã¬ª –∏ —Å–≤—è–∑–µ–π —Å –∫–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–æ–π –≤ –®–≤–∞—Ä—Ü–≤–∞–ª—å–¥–µ.

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (Infrastructure)
- **ESLint Fix**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `lint-staged` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Flat Config –≤ –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
- **Type Safety**: –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ `any` –≤ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (`VisualNovelOverlay`, `CaseCard`, `MapView`) –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é `Evidence` –∏ `MapAction`.
- **Pure Hooks**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ —á–∏—Å—Ç–æ—Ç—ã –≤ `DetectiveMarker` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Date.now()` –≤ render –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `useEffect`).
- **Commit Workflow**: –£–±—Ä–∞–Ω `tsc --noEmit` –∏–∑ `lint-staged` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Ñ–ª–∞–≥–æ–≤.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä–Ω–µ–≤–æ–π `package.json` (eslint paths).
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—à–µ–Ω—ã –≤ `master`.

---
---

## [26.01.2026] ‚Äî –ú–µ—Ö–∞–Ω–∏–∫–∞ –î–µ–¥—É–∫—Ü–∏–∏ –∏ –ö—Ä–∏–º–∏–Ω–∞–ª–∏—Å—Ç–∏–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Deduction Board (–î–æ—Å–∫–∞ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è)**: –ù–æ–≤—ã–π UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –î–æ—Å—å–µ, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª –¥–µ—Ç–µ–∫—Ç–∏–≤–∞ (–ø—Ä–æ–±–∫–æ–≤–∞—è –¥–æ—Å–∫–∞). –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞—Ç—å —É–ª–∏–∫–∏ –Ω–∏—Ç—è–º–∏.
- **Deduction Engine**: –õ–æ–≥–∏–∫–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —É–ª–∏–∫ (`combineEvidence`). –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤: `–£–ª–∏–∫–∞ –ê + –£–ª–∏–∫–∞ –ë = –†–µ–∑—É–ª—å—Ç–∞—Ç` (–æ—Ç–∫—Ä—ã—Ç–∏–µ —Ç–æ—á–∫–∏, —Ñ–ª–∞–≥–∞ –∏–ª–∏ –º–∏–Ω–∏-–∏–≥—Ä—ã).
- **Chemical Analysis (–ú–∏–Ω–∏-–∏–≥—Ä–∞)**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –º–æ–¥–∞–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞ ¬´–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ö–∏–ª–∏–∞–Ω–∏¬ª. –ú–µ—Ö–∞–Ω–∏–∫–∞ —Ç–∏—Ç—Ä–æ–≤–∞–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–µ–ª—å —Ä–µ–∞–≥–µ–Ω—Ç–∞) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–µ—â–µ—Å—Ç–≤.
- **Assets**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∞—Å—Å–µ—Ç—ã: —Ñ–æ–Ω –¥–æ—Å–∫–∏, –±—É—Ç—ã–ª—å —Å —Ä–µ–∞–≥–µ–Ω—Ç–æ–º, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ö–∏–º–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–∫—Ü–∏–∏.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Zustand Store**: –†–∞—Å—à–∏—Ä–µ–Ω `DossierState` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `unlockedDeductions`.
- **Optimization**: –ê—Å—Å–µ—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `public/images/detective`.
- **Refactor**: –£–±—Ä–∞–Ω—ã —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `store.ts` —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ä–µ–µ—Å—Ç—Ä–∞ –¥–µ–¥—É–∫—Ü–∏–π.

---
*–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: –†–∞–∑–≤–∏—Ç–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–≤—ã–∫–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ü–∞—Ä–ª–∞–º–µ–Ω—Ç–∞ –≤ –º–µ—Ö–∞–Ω–∏–∫–∏ –¥–µ–¥—É–∫—Ü–∏–∏.*

